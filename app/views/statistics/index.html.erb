<div class="container mx-auto py-10">
  <section class="mb-12">
    <div class="card bg-base-100 shadow rounded-xl p-6">
      <h2 class="text-xl font-semibold mb-4 text-neutral">Iniciar Nova Análise de Usuário</h2>
      <%= form_with(url: analyze_index_path, method: :post, local: true, html: { class: "flex items-center gap-4" }) do %>
        <%= text_field_tag :username, nil,
          placeholder: "Digite o nome de usuário (ex: Bret)",
          class: "input input-bordered w-full max-w-xs" %>
        <%= submit_tag "Analisar", class: "btn btn-primary" %>
      <% end %>
    </div>
  </section>

  <h1 class="text-3xl font-bold mb-6">Estatísticas do Sistema</h1>

  <section class="mb-10">
    <h2 class="text-xl font-semibold mb-2">Palavras-chave cadastradas</h2>
    <ul class="flex flex-wrap gap-2">
      <% @keywords.each do |keyword| %>
        <li class="badge badge-neutral"><%= keyword.term %></li>
      <% end %>
    </ul>
  </section>

  <section class="mb-10">
    <h2 class="text-xl font-semibold mb-4">Métricas do Grupo</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6">
      <div class="card bg-base-100 shadow rounded-xl p-4">
        <div class="text-xs text-neutral/50 mb-1">Total de Usuários</div>
        <div class="text-2xl font-bold text-primary"><%= @group_metrics[:total_users] %></div>
      </div>
      <div class="card bg-base-100 shadow rounded-xl p-4">
        <div class="text-xs text-neutral/50 mb-1">Total de Comentários</div>
        <div class="text-2xl font-bold text-primary"><%= @group_metrics[:total_comments] %></div>
      </div>
      <div class="card bg-base-100 shadow rounded-xl p-4">
        <div class="text-xs text-neutral/50 mb-1">Aprovados</div>
        <div class="text-2xl font-bold text-success"><%= @group_metrics[:approved_comments] %></div>
      </div>
      <div class="card bg-base-100 shadow rounded-xl p-4">
        <div class="text-xs text-neutral/50 mb-1">Rejeitados</div>
        <div class="text-2xl font-bold text-error"><%= @group_metrics[:rejected_comments] %></div>
      </div>
      <div class="card bg-base-100 shadow rounded-xl p-4">
        <div class="text-xs text-neutral/50 mb-1">Taxa Aprovação</div>
        <div class="text-2xl font-bold text-info"><%= number_to_percentage(@group_metrics[:approval_rate] * 100, precision: 1) %></div>
      </div>
      <div class="card bg-base-100 shadow rounded-xl p-4">
        <div class="text-xs text-neutral/50 mb-1">Média</div>
        <div class="text-2xl font-bold"><%= number_with_precision(@group_metrics[:average_comment_length], precision: 2) %></div>
      </div>
      <div class="card bg-base-100 shadow rounded-xl p-4">
        <div class="text-xs text-neutral/50 mb-1">Mediana</div>
        <div class="text-2xl font-bold"><%= number_with_precision(@group_metrics[:median_comment_length], precision: 2) %></div>
      </div>
      <div class="card bg-base-100 shadow rounded-xl p-4">
        <div class="text-xs text-neutral/50 mb-1">Desvio-padrão</div>
        <div class="text-2xl font-bold"><%= number_with_precision(@group_metrics[:stddev_comment_length], precision: 2) %></div>
      </div>
    </div>
  </section>

  <section>
    <h2 class="text-xl font-semibold mb-4">Métricas por Usuário</h2>
    <div class="overflow-x-auto">
      <table class="table w-full">
        <thead>
          <tr>
            <th>Usuário</th>
            <th>Aprovados</th>
            <th>Rejeitados</th>
            <th>Taxa Aprovação</th>
            <th>Média</th>
            <th>Mediana</th>
            <th>Desvio-padrão</th>
          </tr>
        </thead>
        <tbody>
          <% @user_metrics.each do |data| %>
            <tr>
              <td><%= data[:user].username %></td>
              <td><%= data[:metrics][:approved_count] %></td>
              <td><%= data[:metrics][:rejected_count] %></td>
              <td><%= number_to_percentage(data[:metrics][:approval_rate] * 100, precision: 1) %></td>
              <td><%= number_with_precision(data[:metrics][:average_length], precision: 2) %></td>
              <td><%= number_with_precision(data[:metrics][:median_length], precision: 2) %></td>
              <td><%= number_with_precision(data[:metrics][:stddev_length], precision: 2) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </section>
</div>
